{% extends 'templates/app.twig' %}

{% block styles %}
    <link rel="stylesheet" href="{{ base_url() }}/css/product_detail.css">
{% endblock %}

{% block content %}
    <div class="product-detail-container">
        <div class="product-detail-grid">
            <!-- Gambar Produk -->
            <div class="product-image-section">
                <div class="image-container">
                    {% if product.image_url %}
                        <img src="{{ product.image_url }}" class="product-img" alt="{{ product.name }}">
                    {% else %}
                        <img src="https://images.unsplash.com/photo-1556656793-08538906a9f8?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" class="product-img" alt="No Image">
                    {% endif %}
                </div>
            </div>

            <!-- Detail & Order -->
            <div class="product-info-section">
                <div class="product-header">
                    <div class="category-badge">{{ product.category|default('Produk') }}</div>
                    <h1 class="product-title">{{ product.name }}</h1>
                    <div class="product-meta">
                        <span class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            {{ product.created_at|date("d M Y H:i") }}
                        </span>
                        <span class="meta-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            ID: {{ product.id }}
                        </span>
                    </div>
                </div>

                <div class="price-section">
                    <div class="price-label">Harga</div>
                    <div class="price-amount" id="price">Rp {{ product.price|number_format(0, ',', '.') }}</div>
                </div>

                <div class="stock-section">
                    <div class="stock-label">Stok Tersedia</div>
                    <div class="stock-badge {% if product.qty > 10 %}in-stock{% elseif product.qty > 0 %}limited-stock{% else %}out-stock{% endif %}">
                        {% if product.qty > 10 %}
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                            {{ product.qty }} unit
                        {% elseif product.qty > 0 %}
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                            </svg>
                            {{ product.qty }} unit tersisa
                        {% else %}
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="15" y1="9" x2="9" y2="15"></line>
                                <line x1="9" y1="9" x2="15" y2="15"></line>
                            </svg>
                            Stok Habis
                        {% endif %}
                    </div>
                </div>

                <div class="description-section">
                    <h3 class="section-title">Deskripsi Produk</h3>
                    <p class="description-text">{{ product.description|default('Deskripsi belum tersedia') }}</p>
                </div>

                <!-- Pesan Error -->
                <div id="errorMsg" class="alert-message error d-none"></div>

                <!-- Form Order -->
                <form action="/order/{{ product.id }}" method="GET" id="orderForm" class="order-form">
                    <div class="form-group">
                        <label for="quantity" class="form-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4H6z"></path>
                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                <path d="M16 10a4 4 0 0 1-8 0"></path>
                            </svg>
                            Jumlah Pembelian
                        </label>
                        <div class="quantity-control">
                            <button type="button" class="qty-btn minus" onclick="adjustQuantity(-1)">âˆ’</button>
                            <input type="number" name="quantity" id="quantity" class="quantity-input" value="1" min="1" max="{{ product.qty }}">
                            <button type="button" class="qty-btn plus" onclick="adjustQuantity(1)">+</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                            </svg>
                            Total Pembayaran
                        </label>
                        <div class="total-price-display" id="totalPrice">
                            Rp {{ product.price|number_format(0, ',', '.') }}
                        </div>
                    </div>

                    <button type="submit" class="submit-btn" id="buyBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                        Beli Sekarang
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
{% endblock %}